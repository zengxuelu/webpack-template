webpackJsonp([7],{L4p3:function(e,t){},ea31:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("woOf"),l=r.n(a),i=r("//Fk"),n=r.n(i),s=r("P9l9"),u=r("IcnI"),o=r("Xu2r"),c=r("oqQY"),m=r.n(c),p={data:function(){return{pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-6048e5),e.$emit("pick",[r,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-2592e6),e.$emit("pick",[r,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-7776e6),e.$emit("pick",[r,t])}}]},logintypes:[{value:0,label:"无需登录"},{value:1,label:"巨人通行证"},{value:2,label:"游戏内登录"}],tags:null,ruleForm:{title:"",endmsg:"",desc:"",redirecturl:"",logintype:2,date:[],type:[]},inputVisible:!1,inputValue:"",rules:{title:[{required:!0,message:"请输入问卷名称",trigger:"blur"}],desc:[{required:!0,message:"请输入欢迎语",trigger:"blur"}],endmsg:[{required:!0,message:"请输入结束提示语",trigger:"blur"}],date:[{required:!0,type:"array",message:"请选择日期",trigger:"change"}],logintype:[{required:!0,message:"请选择登录方式",trigger:"change"}],type:[{type:"array",message:"请至少选择一个问卷标签",trigger:"change"}]}}},mounted:function(){this.init()},methods:{handleClose:function(e){this.tags.splice(this.tags.indexOf(e),1)},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick(function(t){e.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm:function(){var e=this.inputValue;e&&this.tags.push({label:e,selected:!0}),this.inputVisible=!1,this.inputValue=""},addTag:function(e){this.tags.splice(e,1,{label:this.tags[e].label,selected:!this.tags[e].selected})},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var r=void 0;t.tags&&t.tags&&(r=t.tags.filter(function(e){return e.selected}).map(function(e){return e.label})),r=r.concat(t.selectedtags);var a={title:t.ruleForm.title,desc:t.ruleForm.desc,starttime:m()(t.ruleForm.date[0]).format("YYYY-MM-DD"),endtime:m()(t.ruleForm.date[1]).format("YYYY-MM-DD"),endmsg:t.ruleForm.endmsg,status:0,logintype:t.ruleForm.logintype,redirecturl:t.ruleForm.redirecturl,tags:r.join(",")};t.$route.params.sid&&(a.sid=t.$route.params.sid),s.a.saveSurveyBase(a).then(function(e){e&&(u.a.commit(o.n,"question"),t.$router.push({path:"/edit/"+e.data.sid+"/question/"}))})})},resetForm:function(e){this.$refs[e].resetFields()},init:function(){var e=this;this.$route.params.sid?n.a.all([s.a.getInfo(this.$route.params.sid),s.a.getTagList()]).then(function(t){if(t[0]){e.ruleForm=l()({},t[0].data,{date:[new Date(t[0].data.starttime),new Date(t[0].data.endtime)]});var r=t[0].data.tags.split(",");e.tags=t[1].data.map(function(e){return{label:e,selected:!!r.some(function(t){return t==e})}})}}):s.a.getTagList().then(function(t){t&&(e.tags=t.data.map(function(e){return{label:e,selected:!1}}))})}}},d=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"base-container"},[r("el-card",{staticClass:"form",attrs:{"body-style":{padding:"0px"}}},[r("el-form",{ref:"ruleForm",staticClass:"content",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"问卷标题",prop:"title"}},[r("el-input",{model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"欢迎语",prop:"desc"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.desc,callback:function(t){e.$set(e.ruleForm,"desc",t)},expression:"ruleForm.desc"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"完成提示",prop:"endmsg"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.endmsg,callback:function(t){e.$set(e.ruleForm,"endmsg",t)},expression:"ruleForm.endmsg"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"问卷有效期",prop:"date"}},[r("el-date-picker",{staticStyle:{width:"360px"},attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},model:{value:e.ruleForm.date,callback:function(t){e.$set(e.ruleForm,"date",t)},expression:"ruleForm.date"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"登录方式",prop:"logintype"}},[r("el-select",{attrs:{placeholder:"请选择登录方式"},model:{value:e.ruleForm.logintype,callback:function(t){e.$set(e.ruleForm,"logintype",t)},expression:"ruleForm.logintype"}},e._l(e.logintypes,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"结束后跳转",prop:"redirecturl"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请填写跳转地址"},model:{value:e.ruleForm.redirecturl,callback:function(t){e.$set(e.ruleForm,"redirecturl",t)},expression:"ruleForm.redirecturl"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"问卷标签",prop:"type"}},[r("div",[e.inputVisible?r("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):r("el-button",{attrs:{size:"small"},on:{click:e.showInput}},[e._v("找不到标签？添加标签 +")])],1),e._v(" "),e.tags&&e.tags.length?r("div",e._l(e.tags,function(t,a){return r("el-button",{key:a,attrs:{size:"small",type:t.selected?"primary":""},on:{click:function(t){return e.addTag(a)}}},[e._v(e._s(t.label))])}),1):e._e()]),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(e._s(e.$route.params.sid?"保存":"立即创建"))]),e._v(" "),r("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1)],1)],1)],1)};d._withStripped=!0;var g={render:d,staticRenderFns:[]},f=g;var v=!1;var b=r("VU/8")(p,f,!1,function(e){v||r("L4p3")},null,null);b.options.__file="src/views/question/base.vue";t.default=b.exports}});
//# sourceMappingURL=7.656fb81b80a1da07c3c8.js.map